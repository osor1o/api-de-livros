<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no" />
    <title>Document</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        nav {
            height: 75px;
            line-height: 75px;
        }
        nav .brand-logo {
            font-size: 2.3em;
        }
    </style>
</head>
<body>
    <div class="navbar-fixed">
        <nav>
            <div class="nav-wrapper blue">
                <div class="brand-logo center">Books API</div>
            </div>
        </nav>
    </div>
    <div class="fixed-action-btn toolbar direction-top">
        <a class="btn-floating btn-large blue">
            <i class="material-icons">menu</i>
        </a>
        <ul>
            <li class="waves-effect waves-light">
                <a class="modal-trigger" href="#modalAddBook">
                    <i class="material-icons">add</i>
                </a>
            </li>
            <li class="waves-effect waves-light">
                <a id="update" class="material-icons">
                    <i class="material-icons">autorenew</i>
                </a>
            </li>
        </ul>
    </div>
    <div class="container section">
        <div class="section">
            <div id="alert" style="display: none" class="card-panel red lighten-1 white-text row">
                <b>search error :(</b>
            </div>
            <div id="loading" class="row center">
                <img src="loading.gif">
            </div>
            <div class="row" id="books">
            </div>
        </div>
    </div>
    <div id="modalAddBook" class="modal modal-fixed-footer">
        <div class="modal-content">
            <div class="row">
                <h4><i class="material-icons">book</i>  Add Book</h4>
            </div>
            <div style="display: none" id="addLoading" class="row center">
                <img src="loading.gif">
            </div>
            <div id="addAlert" style="display: none" class="card-panel red lighten-1 white-text row">
                <b>Can not add your book :(</b>
            </div>
            <div id="addForm" class="row">
                <form class="col s12">
                    <div class="row section">
                        <div class="input-field col s12">
                            <input id="addFirstName" type="text">
                            <label for="addFirstName">First Name</label>
                        </div>
                        <div class="input-field col s12">
                            <input id="addLastName" type="text">
                            <label for="addLastName">Last Name</label>
                        </div>
                        <div class="input-field col s12">
                            <input id="addTitle" type="text">
                            <label for="addTitle">Title</label>
                        </div>
                        <div class="input-field col s12">
                            <textarea id="addDescription" class="materialize-textarea"></textarea>
                            <label for="addDescription">Description</label>
                        </div>
                        <div class="input-field col s12">
                            <input id="addPrice" type="number">
                            <label for="addPrice">Price</label>
                        </div>
                        <div class="input-field col s12">
                            <input id="addWidth" type="text">
                            <label for="addWidth">Width (cm)</label>
                        </div>
                        <div class="input-field col s12">
                            <input id="addHeight" type="number">
                            <label for="addHeight">Height (cm)</label>
                        </div>
                        <div class="input-field col s12">
                            <input id="addWeight" type="number">
                            <label for="addWeight">Weight (kg)</label>
                        </div>
                        <div class="input-field col s12">
                            <input id="addLength" type="number">
                            <label for="addLength">Length (cm)</label>
                        </div>
                        <div class="input-field col s12">
                            <input id="addCellPhone" type="number" class="validate">
                            <label for="addCellPhone">Cell Phone</label>
                        </div>
                        <div class="input-field col s12">
                            <input id="addCep" type="text" class="validate">
                            <label for="addCep">CEP</label>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <div class="modal-footer">
            <a class="modal-close waves-effect waves-green btn-flat  blue-grey darken-2 white-text">Cancel</a>
            <a id="addSubmit" class="waves-effect waves-green btn-flat blue white-text">Save</a>
        </div>
    </div>
    <div id="modalBook" class="modal modal-fixed-footer">
            <div class="modal-content">
                    <h4><i class="material-icons">shopping_cart</i>  Buy Book</h4>
                    <div class="row">
                        <form class="col s12">
                            <div class="row">
                                <div class="input-field col s12">
                                    <p class="flow-text">Harry Potter</p>
                                    <p>Description: <span>rari poter</span></p>
                                    <p>Height: <span>20</span></p>
                                    <p>Width: <span>20</span></p>
                                    <p>Weight: <span>1</span></p>
                                    <p>Seller Name: <span>Os√≥rio</span></p>
                                    <p>Seller Number: <span>45645454</span></p>
                                </div>
                                <div class="input-field col s12">
                                    <input id="cep" type="text" class="validate">
                                    <label for="cep">CEP</label>
                                </div>
                                <div class="input-field col s12">
                                    <a class="modal-close waves-effect waves-green btn-flat  blue white-text">Calculate</a>
                                </div>
                                <div class="input-field col s12">
                                    <table class="responsive-table">
                                        <thead>
                                            <tr>
                                                <th>Service</th>
                                                <th>Price</th>
                                                <th>delivery</th>
                                            </tr>
                                        </thead>
                                    
                                        <tbody>
                                            <tr>
                                            <td>SEDEX</td>
                                            <td>R$55,00</td>
                                            <td>11 Days</td>
                                            </tr>
                                            <tr>
                                            <td>PAC</td>
                                            <td>R$70,00</td>
                                            <td>7 Days</td>
                                            </tr>
                                        </tbody>
                                    </table>                                
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="modal-footer">
                    <a class="modal-close waves-effect waves-green btn-flat  blue-grey darken-2 white-text">Cancel</a>
                    <a class="modal-close waves-effect waves-green btn-flat blue white-text">Buy</a>
                </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    
    <script>
        (function () {
            const url = 'http://localhost:8081';
            var elems = document.querySelectorAll('.modal');
            var instancesModal = M.Modal.init(elems);
            var instanceModal = (elem) => M.Modal.getInstance(elem);

            document.addEventListener('DOMContentLoaded', function() {
                var elems = document.querySelectorAll('.fixed-action-btn');
                var instances = M.FloatingActionButton.init(elems, {
                toolbarEnabled: true
                });
            });

            var createElement = (value) => document.createElement(value);
            var getId = (value) => document.getElementById(value);
            var getClass = (value) => document.getElementsByClassName(value);
            
            findAll();

            getId('update').onclick = function () {
                findAll();
            }

            getId('addSubmit').onclick = function () {
                var parameters = {
                    title: getId('addTitle').value,
                    description: getId('addDescription').value,
                    width: getId('addWidth').value,
                    height: getId('addHeight').value,
                    length: getId('addLength').value,
                    weight: getId('addWeight').value,
                    firstName: getId('addFirstName').value,
                    lastName: getId('addLastName').value,
                    cellPhone: getId('addCellPhone').value,
                    cep: getId('addCep').value,
                    price: getId('addPrice').value
                }
                insert(parameters);
            }
            
            function findAll() {
                getId('books').innerHTML = null;
                getId('alert').style.display = 'none';
                getId('loading').style.display = 'block';
                
                axios.get(url)
                    .then(function (response) {
                        data = response.data;
                        if(data.length < 1) {
                            getId('alert').innerHTML = "<b>No books found :(</b>";
                            getId('alert').style.display = 'block';
                        } else {
                            data.forEach(book => getId('books').appendChild(createBook(book)));
                        }
                    })
                    .catch(function (error) {
                        getId('alert').innerHTML = "<b>Search error :(</b>";
                        getId('alert').style.display = 'block';
                    })
                    .then(function () {
                        getId('loading').style.display = 'none';
                        clickBook();
                    });
            }

            function insert(parameters) {
                getId('addLoading').style.display = 'block';
                getId('addAlert').style.display = 'none';
                getId('addForm').style.display = 'none';
                
                axios.post(url, parameters)
                    .then(function (response) {
                        findAll();
                        instanceModal(getId('modalAddBook')).close();
                        getId('addTitle').value = null;
                        getId('addDescription').value = null;
                        getId('addWidth').value = null;
                        getId('addHeight').value = null;
                        getId('addLength').value = null;
                        getId('addWeight').value = null;
                        getId('addFirstName').value = null;
                        getId('addLastName').value = null;
                        getId('addCellPhone').value = null;
                        getId('addCep').value = null;
                        getId('addPrice').value = null;
                        getId('addAlert').style.display = 'none';
                        
                    })
                    .catch(function (error) {
                        getId('addAlert').style.display = 'block';
                    })
                    .then(function () {
                        getId('addLoading').style.display = 'none';
                        getId('addForm').style.display = 'block';
                    });
            }

            function findCep(parameters) {
                //
            }

            function clickBook() {
                for(let i = 0; i < getClass('book').length; i++) {
                    getClass('book')[i].onclick = function () {
                        alert(1);
                        console.log(data);
                        // document.getElementById('book').getElementsByTagName('h4')[0].innerText = this.getElementsByTagName('span')[0].innerText;
                    }
                }
            }

            function createBook(data) {
                let book = createElement('div');
                book.className = "col s6 m3 book section";
                let a = createElement('a');
                a.className = "modal-trigger";
                a.href = "#modalBook";
                let card = createElement('div');
                card.className = "card";
                let cardImage = createElement('div');
                cardImage.className = "card-image";
                let img = createElement('img');
                img.src = "https://i.ibb.co/tPVQxSR/booksAPI.png";
                let cardContent = createElement('div');
                cardContent.className = "card-content";
                cardContent.style.height = "125px";
                cardContent.style.overflow = "hidden";
                let title = createElement('span');
                title.className = "black-text";
                if(data.title.length > 30) {
                    data.title = data.title.slice(0,30) + "..."
                }
                title.innerText = data.title.slice();
                let price = createElement('p');
                price.className = "blue-text";
                price.innerText = "R$"+data.price;
                cardImage.appendChild(img);
                cardContent.appendChild(title);
                cardContent.appendChild(price);
                card.appendChild(cardImage);
                card.appendChild(cardContent);
                a.appendChild(card);
                book.appendChild(a);
                return book;
            }
            
        })();
        
       
    </script>
</body>
</html>